@using Whiskey.ZeroStore.ERP.Transfers
@using System.Collections
@using Whiskey.Utility.Data
@using Whiskey.ZeroStore.ERP.Transfers.Enum.Warehouse
@model CheckerDto
<style>
    #right_sel ul li {
         padding: 0 !important;
    }

    .disable_all_conte {
        position: relative;
        z-index: -100;
        opacity: 0.3 !important;
        cursor: not-allowed;
    }

    .enabled_all_conte {
        z-index: 100 !important;
        opacity: 1.0 !important;
    }

    .table-list1 th, td {
        text-align: center;
    }
   #cur_stored>.form-control>.open>.dropdown-menu li a, #cur_selected>.form-control>.open>.dropdown-menu li a{
    	width: 134px !important;
    }
</style>
<div class="row enabled_all_conte">
    <input id="isContin" type="hidden" value="@ViewBag.IsContin" />
    <div id="left_content">
        <div class="col-md-6">
            <div class="panel panel-info panel-dark widget-profile">
                <div class="panel-heading">
                    <div class="widget-profile-bg-icon"></div>
                    <div class="widget-profile-header text-center">
                        <h3>请使用扫码枪将商品货号扫入下边文本框</h3>
                    </div>
                </div>
                <div class="list-group-item no-border-hr clearfix valign-midd
                 le">
                    <div>
                        <div class="col-md-3"></div>
                        <div class="col-md-6 text-center" style="margin-bottom:10px">
                            @Html.TextBox("ScanNumber", "", new { @placeholder = "", @class = "scan-number form-control text-center", @style = "ime-mode:disabled;height:45px;margin-top:20px;", @onkeyup = "this.value=this.value.toUpperCase().replace(/[\u4e00-\u9fa5]/g,'')" })
                        </div>

                        <div>
                            <input class="form-control" id="selec_prodBatch_list" type="button" value="批量导入……" style="font-weight: bold;" />
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                </div>
                <div class="widget-profile-counters clearfix" id="count_but_li">
                    <div class="col-xs-2"><label id="checkCount" class="label label-info scan-queue-count">@Model.CheckedQuantity</label><br /><a class="checkCount" style="cursor:default">待盘</a></div>
                    <div class="col-xs-2"><label id="checkedCount" class="label label-success scan-valid-count">@Model.CheckedQuantity</label><br /><a class="checkedCount" style="cursor:default">已盘</a></div>
                    <div class="col-xs-2 validCount" style="cursor:pointer"><label id="validCount" class="label label-danger scan-invalid-count" style="cursor:pointer">@Model.ValidQuantity</label><br /><a>有效</a></div>
                    <div class="col-xs-2 invalidCount" style="cursor:pointer"><label id="invalidCount" class="label label-danger scan-invalid-count" style="cursor:pointer">@*@Model.InvalidQuantity*@</label><br /><a>无效</a></div>
                    <div class="col-xs-2 missingCount" style="cursor:pointer"><label id="missingCount" class="label label-danger scan-invalid-count" style="cursor:pointer">@Model.MissingQuantity</label><br /><a>缺货</a></div>
                    <div class="col-xs-2 residueCount" style="cursor:pointer"><label id="residueCount" class="label label-danger scan-invalid-count" style="cursor:pointer">@Model.ResidueQuantity</label><br /><a>余货</a></div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6" id="right_sel">
        <form id="form_dat_righ" enctype="multipart/form-data">
            <div class="stat-panel">
                <div class="stat-row">
                    <div class="stat-cell padding-sm bordered valign-top">
                        <div id="right-sel-cont">
                            <ul style="padding-left:0">
                                <li class="list-group-item no-border-hr no-border-t no-bg no-border-radius clearfix">
                                    <div class="form-group" style="padding: 8px;">
                                        <input name="Id" id="checkerId" type="hidden" />
                                        <label class="control-label col-md-2" style="padding:0;text-align:right">盘点店铺：</label>
                                        <div class="col-md-4" style="text-align:left">
                                            <select class="form-control receive-store" id="StoreId" name="StoreId"></select>
                                        </div>
                                        <label class="control-label col-md-2" style="padding:0;text-align:right;">盘点仓库：</label>
                                        <div class="col-md-4" style="text-align:left" id="cur_stored">
                                            @Html.DropDownListFor(x => x.StorageId, (List<SelectListItem>)ViewBag.StorageList, "请选择仓库", new { @class = "form-control  selectpicker cur_selectpicker receive-store " , data_live_search="true"})
                                        </div>
                                    </div>
                                </li>
                                <li class="list-group-item no-border-hr no-border-t  no-bg no-border-radius clearfix">
                                    <div class="form-group" style="padding: 8px;">
                                        <label class="control-label col-md-2" style="padding:0;text-align:right">品牌：</label>
                                        <div class="col-md-4" style="text-align:left">
                                            @Html.DropDownListFor(x => x.BrandId, (List<SelectListItem>)ViewBag.BrandList, new { @class = "form-control receive-store selectpicker cur_selectpicker", data_live_search="true" })
                                        </div>
                                        <label class="control-label col-md-2" style="padding:0;text-align:right;">款式：</label>
                                        <div class="col-md-4" style="text-align:left" id="cur_selected">
                                            @Html.DropDownListFor(x => x.CategoryId, (List<SelectListItem>)ViewBag.CategoryList, new { @class = "form-control receive-store selectpicker cur_selectpicker", data_live_search="true" })
                                        </div>
                                    </div>
                                </li>

                                <li class="list-group-item no-border-hr no-border-t no-bg no-border-radius clearfix" style="display:none">
                                    <div class="form-group" style="padding: 8px;">
                                       

                                        <label class="control-label col-md-2" style="padding:0;text-align:right">入库日期：</label>
                                        <div class="col-md-4">
                                            <div class="input-group date purchase-date">
                                                @Html.TextBox("CreateTime", "", new { @class = "form-control", @placeholder = "点击选择时间", @style = "height:35px;font-size:12px;padding:0" })
                                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                            </div>
                                        </div>
                                    </div>
                                </li>

                                <li class="list-group-item no-border-hr no-border-t  no-bg no-border-radius clearfix" style="padding: 8px;">
                                    <label class="control-label col-md-2" style="padding:0;text-align:right">备注信息：</label>
                                    <div class="col-md-10">
                                        @Html.TextBoxFor(x => x.Notes, new { @class = "form-control" })
                                    </div>
                                </li>

                            </ul>
                        </div>
                        <div style="margin: 31px 74px;">
                            <button id="Check_start" type="button" class="btn btn-success  btn-padding-right"><i class="fa fa-arrow-right"></i> 开始盘点</button>
                            <button id="Check_ok" type="button" class="btn btn-primary btn-padding-right" style="background-color:blue"><i class="fa fa-check"></i> 结束盘点</button>
                            <button id="Check_reset" type="button" class="btn btn-danger btn-padding-right"><i class="fa fa-repeat"></i> 重置</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <input type="hidden" id="hid_ordflag" value="@ViewBag.orderflag" />
    </div>
    @*<div class="col-md-12">
            <div class="panel  panel-list">
                <div class="panel-heading">
                    <div class="panel-title">
                        <h5><i id="show_tit" class="fa fa-list"></i></h5>
                    </div>
                    <span class="text-right list-info"></span>
                </div>
                <div id="tab_da_li">
                    <table class="table table-list1 table-hover valign-middle" width="100%">
                        <thead>
                        </thead>
                    </table>
                </div>
            </div>
        </div>*@
</div>
<input type="hidden" id="OrderblakNum" value="@ViewBag.OrderblakNum" />
@section Scripts{
    <script type="text/javascript">
        var hashlist = new $.whiskey.hashtable();
        $(document).ready(function () {
            $("#StoreId").queryManageStore();
            var isconti = $("#isContin").val();
            if (isconti == 1) {
                //禁用右侧
                allRightDisabled();
                continuChecker();

            } else {
                //禁用左侧的扫描框
                allDisabled();
            }
            var IsContinute = "@ViewBag.IsContinute";
            var OrderblakNum = "@ViewBag.OrderblakNum";
            if (IsContinute == "True" || (OrderblakNum != "" && OrderblakNum != null)) {
                debugger
                $("#Check_ok").removeAttr("disabled");
                //禁用右侧
                allRightDisabled();
                allEnabled();
                var Id = "@Model.Id";
                var StoreId = "@Model.StoreId";
                var StorageId = "@Model.StorageId";
                var BrandId = "@Model.BrandId";
                var CategoryId = "@Model.CategoryId";
                @*var SeasonId = "@Model.SeasonId";
            var SizeID = "@Model.SizeId";;
            var ColorId = "@Model.ColorId";*@
                var CreateTime = ""; //entity.CreatedTime;
                var CheckCount = "@Model.BeforeCheckQuantity";
                var CheckedCount = "@Model.CheckedQuantity";
                var ValidCount = "@Model.ValidQuantity";
                var InvalidCount = "@Model.InvalidQuantity";
                var MissingCount = "@Model.MissingQuantity";
                var ResidueCount = "@Model.ResidueQuantity";
                var Notes = "@Model.Notes";

                setText($("#checkCount"), CheckCount);
                setText($("#checkedCount"), CheckedCount);
                setText($("#validCount"), ValidCount);
                setText($("#invalidCount"), InvalidCount);
                setText($("#missingCount"), MissingCount);
                setText($("#residueCount"), ResidueCount);

                //初始化盘点数据
                $("#checkerId").attr("value", Id);
                //初始化盘点参数
                initSelectParams($("#StoreId"), StoreId)
                initSelectParams($("#StorageId"), StorageId)
                initSelectParams($("#BrandId"), BrandId)
                //initSelectParams($("#SeasonId"), SeasonId)
                //initSelectParams($("#ColorId"), ColorId)
                //初始化仓库
                initStorage(StoreId, StorageId);
                //initSize(CategoryId, SizeID);
                $("#Notes").attr("value", Notes);

            }
            $("#Create").on("click", function () {

            });




            $(".scan-invalid").on("click", function () {
                var view = new $.whiskey.web.ajaxView({
                    caption: "商品无效码列表",
                    actionUrl: "@Url.Action("Invalid")",
                    lockButton: $(this),
                });
            });

            $("#RemoveAll").on("click", function () {
                var list = $.whiskey.web.getIdByChecked(".table-list td input[type=checkbox]");
                if (list.length > 0) {
                    var confirm = new $.whiskey.web.ajaxConfirm({
                        question: "确认要移除这些商品吗？",
                        notes: "提示：此操作会将商品从服务器缓存中移除",
                        actionUrl: "@Url.Action("Remove")",
                        params: list,
                        complete: function () {
                            $.whiskey.datatable.reset();
                        }
                    });
                } else {
                    $.whiskey.web.alert({
                        type: "info",
                        content: "请至少选择一条数据！",
                        callback: function () {
                        }
                    });
                }
            });

            $("#CreateTime").datepicker();

            $.whiskey.datatable.instance = $(".table-list1").dataTable({
                "aaSorting": [[0, 'desc']],
                //"sAjaxSource": "@Url.Action("List")",
                "sDom": 't<"F clearfix datatable-footer"<"col-md-2"l><"col-md-3"f><"col-md-7 text-right"p>>',
                "fnDrawCallback": function () {
                    $('.edit-text').editable({
                        type: "text",
                        pk: "",
                        tpl: "<input type='text' class='text-center' style='width: 80px'>",
                        ajaxOptions: {
                            dataType: 'json'
                        },
                        url: "@Url.Action("SetAmount")",
                        validate: function (value) {
                            if ($.trim(value) == '') return '提示：商品数量不能为空！';
                        },
                        title: "请输入新的商品数量",
                        success: function (data, newValue) {
                            if (data.ResultType == 3) {
                                $(".scan-valid-count").text(data.Data.validCount);
                                $.whiskey.datatable.reset(true);
                            }
                        },
                        error: function (errors) {
                        }
                    });
                    $(".checked-all").click(function () {
                        var checkedStatus = this.checked;
                        $(".table tr td input[type=checkbox]").each(function () {
                            this.checked = checkedStatus;
                        });
                    });
                },
                "aoColumns": [{
                    "bVisible": false,
                    "bSearchable": false,
                    "sName": "UpdatedTime",
                    "mData": "UpdatedTime"
                },
                    {
                        "sTitle": $.whiskey.datatable.tplTitleCheckbox(),
                        "bSortable": false,
                        "bSearchable": false,
                        "sName": "Id",
                        "mData": function (data) {
                            return $.whiskey.datatable.tplListCheckbox(data.Id);
                        }
                    }, {
                        "sTitle": "编号",
                        "bSortable": false,
                        "sName": "RowNumber",
                        "mData": function (data) {
                            var index = data.iDisplayIndex + 1;
                            return '' + index + '';
                        }
                    }, {
                        "sTitle": "图片",
                        "sName": "Thumbnail",
                        "bSortable": false,
                        "bSearchable": false,
                        "mData": function (data) {
                            return $.whiskey.datatable.tplThumbnail(data.Thumbnail);
                        }
                    }, {
                        "sTitle": "名称",
                        "sName": "ProductName",
                        "bSortable": false,
                        "mData": "ProductName",
                    }, {
                        "sTitle": "货号",
                        "sName": "ProductNumber",
                        "bSortable": false,
                        "mData": "ProductNumber",
                    }, {
                        "sTitle": "季节",
                        "bSortable": false,
                        "sName": "Season",
                        "mData": "Season",
                    }, {
                        "sTitle": "颜色",
                        "bSortable": false,
                        "sName": "Color",
                        "mData": "Color",
                    }, {
                        "sTitle": "尺码",
                        "bSortable": false,
                        "sName": "Size",
                        "mData": "Size",
                    }, {
                        "sName": "WholesalePrice",
                        "sTitle": "进货价",
                        "mData": function (data) {
                            return '<div>￥' + data.WholesalePrice.toFixed(2) + '<div>（' + $.whiskey.tools.numberToChinese(Math.round(data.WholesalePrice / data.TagPrice * 100)) + '）';
                        },
                    },
                    //{
                    //    "sTitle": "数量",
                    //    "sName": "Amount",
                    //    "mData": function (data) {
                    //        return "<a href=\"#\" class=\"edit-text\" data-name='" + data.ProductNumber + "'>" + data.Amount + "</a>";
                    //    },

                    //},
                    {
                        "sTitle": "操作",
                        "bSortable": false,
                        "bSearchable": false,
                        "mData": function (data) {
                            return $.whiskey.datatable.tplDelete(data.Id);
                        }
                    }
                ]

            });

            $(".scan-number").blur(function () {
                $(this).addClass("input-validation-error");
            }).focus(function () {
                $(this).removeClass("input-validation-error");
            });

            $(".scan-number").keyup(function (event) {
                if (event.keyCode == 13) {
                    var scanNumber = $(this).val().trim();
                    if (scanNumber.length > 0) {
                        var barcodeArr = scanNumber.split(',');
                        if (barcodeArr.length <= 0) {
                            return;
                        }
                        barcodeArr.forEach(function (value, index, arr) {
                            var uuid = $.whiskey.tools.UUID(32, 16);
                            hashlist.put(uuid, value);
                            $(".scan-queue-count").text(hashlist.size());
                            $(".scan-number").val("");
                            $(".scan-number").focus();
                        });

                    }
                }
            }).focus();

            setInterval(function () {
                sendToQueue();
            }, 1000);

            $(window).on('beforeunload', function (e) {
                if (hashlist.size() > 0) {
                    var message = "系统检测到队列中有（" + hashlist.size() + "条数据）还未提交到服务器，刷新或关闭浏览器会导致这些数据丢失！！";
                    e.returnValue = message;
                    return message;
                }
            });

            //开始盘点
            $("#Check_start").click(function () {
                hashlist.clear();
                if (dataValid()) {
                    $("#Check_ok").removeAttr("disabled");
                    $(this).attr("disabled", "disabled");
                    //var dat = $("#form_dat_righ").serialize();
                    //dat = decodeURIComponent(dat);
                    //禁用右侧
                    var o = {};
                    var a = $("#form_dat_righ").serializeArray();
                    $.each(a, function () {
                        if (o[this.name] !== undefined) {
                            if (!o[this.name].push) {
                                o[this.name] = [o[this.name]];
                            }
                            o[this.name].push(this.value || '');
                        } else {
                            o[this.name] = this.value || '';
                        }
                    });
                    allRightDisabled();
                    allEnabled();

                    $.ajax({
                        url: "@Url.Action("StartCheck")",
                        type: "post",
                        data: o,
                        success: function (data) {
                            if (data.ResultType == "@((int)OperationResultType.Success)") {
                                $("#Check_ok").removeAttr("disabled");
                                $(this).attr("disabled", "disabled");
                                allRightDisabled();
                                allEnabled();
                                var entity = data.Data;
                                initParamsCount(entity);
                            } else if (data.ResultType == "@((int)OperationResultType.DataRepeat)") {
                                $.whiskey.web.alert({
                                    type: "info",
                                    content: "继续盘点未盘点完成任务！",
                                    callback: function () {

                                    }
                                });
                                var entity = data.Data;
                                initParamsCount(entity);
                            } else {
                                $.whiskey.web.alert({
                                    type: "danger",
                                    content: data.Message,
                                    callback: function () {
                                        allDisabled();
                                    }
                                });
                            }
                        }
                    });
                }

            });

            //确定结束盘点
            $("#Check_ok").click(function () {
                var OrderblakNum = $("#OrderblakNum").val();
                if (OrderblakNum != null && OrderblakNum != "" && OrderblakNum != undefined) {
                	$.whiskey.web.load({url:"@Url.Action("index", "Purchase")"})
                  //  location.href = "@Url.Action("index", "Purchase")";
                }
                var cou = $.whiskey.tools.other();
                var message = "数据运算较大，请耐心等待";
                if (parseInt(cou) > 0) {
                    message += "系统检测到还有" + cou + "条数据等待盘点，盘点尚未完成，可以在‘盘点管理’中点击‘继续’继续盘点";
                }
                if (hashlist.size() > 0) {
                    message += "已经录入队列的数据还有" + hashlist.size() + "条未完成盘点，刷新或关闭浏览器会导致这些数据丢失！！";
                }
                var checkerId = $("#checkerId").val();

                var printer = new $.whiskey.web.ajaxConfirm({
                    //var
                    actionUrl: "@Url.Action("CheckerOk")",
                    question: "确认要结束盘点吗？",
                    notes: message,
                    params: { Id: checkerId },
                    lockButton: $(this),
                    topMargin: "2%",
                    leftMargin: "4%",
                    contentWidth: "94%",
                    contentHeight: "100%",
                    success: function (da) {
                        $.whiskey.tools.other(-1);
                        hashlist.clear();
                        //盘点完成修改状态
                        var ordnum = $("#hid_ordflag").val();
                        if (ordnum != undefined && ordnum != null && ordnum != "") {
                            $.post("/Warehouses/Orderblank/EditCheckLockStat", { num: ordnum }, function (d) {
                                if (d.ResultType == 3 || d.ResultType == 2) {
                                	$.whiskey.web.load({url: "/Warehouses/Purchase/Index"})
                                 //   location.href = "/Warehouses/Purchase/Index";
                                }
                            })
                        } else {
                        	$.whiskey.web.load({url:'/Warehouses/Checked/Index'})
                           // location.href = '/Warehouses/Checked/Index';
                        }
                    }
                }
                );
            });



            //重置
            $("#Check_reset").click(function () {
                var cou = $.whiskey.tools.other();
                var message = "";
                if (parseInt(cou) > 0) {
                    message += "系统检测到还有" + cou + "条数据等待盘点，盘点尚未完成，可以在‘盘点管理’中点击‘继续’继续盘点";
                }
                if (hashlist.size() > 0) {
                    message += "已经录入队列的数据还有" + hashlist.size() + "条未完成盘点，重置会导致这些数据丢失！！";
                }
                if (message.length > 0) {
                    var notes = $("#Notes").val();
                    var printer = new $.whiskey.web.ajaxConfirm({
                        actionUrl: "@Url.Action("InsertChecked")",
                        question: "确认要重置盘点吗？",
                        notes: message,
                        params: { ty: "unload", notes: notes },
                        lockButton: $(this),
                        topMargin: "2%",
                        leftMargin: "4%",
                        contentWidth: "94%",
                        contentHeight: "100%",
                        success: function (da) {
                            $.whiskey.tools.other(-1);
                            hashlist.clear();
                        }
                    }
                    );
                }

                $("#Check_ok").attr("disabled", "disabled");
                $("#Check_start").removeAttr("disabled");
                allRightEnabled();
                allDisabled();
            });

            //店铺发生改变时
            $("#StoreId").change(function () {
                $("#StorageId").html("");
                var txt = $(this).val();
                if (txt != "" && txt != "-1") {
                    var storId = parseInt(txt);
                    $.post("@Url.Action("GetStorageList", "Inventory")", { storeId: storId }, function (da) {
                        var data = da.Data;
                        console.log(data);
                        if (data) {
                            var options = "";
                            for (var i = 0; i < data.length; i++) {
                                options += "<option value=" + data[i].Value + ">" + data[i].Text + "</option>";
                            }
                            $("#StorageId").html("").html(options);
//                            $('.cur_selectpicker').selectpicker();
       					 $('.cur_selectpicker').selectpicker('refresh');
                        }
                    });
                }
            });


            //批量导入，
            $("#selec_prodBatch_list").click(function () {
                var dialog = new $.whiskey.web.ajaxDialog({
                    caption: "批量导入",
                    successTit: "确定",
                    successEvent: select_check_Access,
                    actionUrl: "@Url.Action("BatchImport")",
                    noneheader: true,
                    lockButton: $(this),
                    methType: "post",
                    //uploadUrl: "/Warehouses/AddProduct/ExcelFileUpload",
                    formValidator: function () {
                        var $form = $(".modal-form");
                        if (!$form.valid()) {
                            $(".modal-dialog").parent("div").animate({ scrollTop: 20 }, 500);
                            return false;
                        } else {
                            return true;
                        }
                    },
                    postComplete: function () {
                        // $.whiskey.datatable.reset(false);
                        return true;
                    },
                });

            });
            //查看有效数据
            $(".validCount").click(function () {
                var checkerItemType = "@((int)CheckerItemFlag.Valid)";
                showDetail(checkerItemType);
            });
            //查看无效数据
            $(".invalidCount").click(function () {
                var checkerItemType = "@((int)CheckerItemFlag.Invalid)";
                showDetail(checkerItemType);
            });
            //查看缺货数据
            $(".missingCount").click(function () {
                var checkerItemType = "@((int)CheckerItemFlag.Lack)";
                showDetail(checkerItemType);
            });
            //查看余货数据
            $(".residueCount").click(function () {
                var checkerItemType = "@((int)CheckerItemFlag.Surplus)";
                showDetail(checkerItemType);
            });
        });

        function sendToQueue() {
            if (hashlist.size() > 0) {
                var globalUUID = hashlist.getFirst(0);
                var scanNumber = hashlist.getFirst(1);
                var Id = $("#checkerId").val();
                var orderblankNumber = $("#OrderblakNum").val();
                $.ajax({
                    type: "POST",
                    //data: { uuid: globalUUID, number: scanNumber },
                    data: { uuid: globalUUID, Id: Id, Number: scanNumber, orderblankNumber: orderblankNumber },
                    async: false,
                    url: "@Url.Action("AddToScan")",
                    success: function (data) {
                        if (data.ResultType == 3) {
                            var entity = data.Data;
                            var CheckQuantity = entity.CheckQuantity;
                            var CheckedQuantity = entity.CheckedQuantity;
                            var ValidQuantity = entity.ValidQuantity;
                            var InvalidQuantity = entity.InvalidQuantity;
                            var MissingQuantity = entity.MissingQuantity;
                            var ResidueQuantity = entity.ResidueQuantity;
                            var ResultType = entity.ResultType;
                            var InvalidType = entity.InvalidType;
                            //初始化盘点数据
                            setText($("#checkCount"), CheckQuantity);
                            setText($("#checkedCount"), CheckedQuantity);
                            //setCheckedCount(CheckedCount,)
                            setText($("#validCount"), ValidQuantity);
                            setText($("#invalidCount"), InvalidQuantity);
                            setText($("#missingCount"), MissingQuantity);
                            setText($("#residueCount"), ResidueQuantity);
                            hashlist.remove(data.Data.UUID);
                            $.whiskey.datatable.reset(true);
                        }
                    }
                });

            }

        }

        function Delete(sender, Id) {
            var confirm = new $.whiskey.web.ajaxConfirm({
                question: "确认要移除这件商品吗？",
                notes: "提示：此操作会将缓存中的指定货号的商品移除",
                actionUrl: "@Url.Action("Remove")",
                params: { Id: Id },
                lockButton: $(sender),
                complete: function (data) {
                    $(".scan-valid-count").text(data.Data.validCount);
                    $.whiskey.datatable.reset(true);
                }
            });
        }

        //获取所有的搜索条件
        function dataValid() {
            var StoreId = $("#StoreId option:selected").val();
            var StorageId = $("#StorageId option:selected").val();
            var BrandId = $("#BrandId option:selected").val();
            var categoryId = $("#CategoryId option:selected").val();
            var SeasonId = $("#SeasonId option:selected").val();
            var sizeID = $("#SizeID option:selected").val();
            var ColorId = $("#ColorId option:selected").val();
            var createTime = $("#CreateTime option:selected").val();
            var notes = $("#Notes option:selected").val();
            var hasStore = StoreId == undefined || StoreId == null || StoreId == "" || StoreId == "-1";
            var hasStorage = StorageId == undefined || StorageId == null || StorageId == "" || StorageId == "-1";
            if (hasStore || hasStorage) {
                $.whiskey.web.alert({
                    type: "warning",
                    content: "请选择需要盘点的仓库！",
                    callback: function () {

                    }
                });
                return false;
            }
            else {
                return true;
            }

        }

        //禁用右侧选择框
        function allRightDisabled() {
            $("#right-sel-cont ul li").css("opacity", 0.5);
            $("#right-sel-cont").find("input").attr("disabled", "disabled");
            $("#right-sel-cont").find("select").attr("disabled", "disabled");

            $("#Check_start").attr("disabled", "disabled");

        }

        //启用右侧选择框
        function allRightEnabled() {
            $("#right-sel-cont ul li").css("opacity", 1);
            $("#right-sel-cont").find("input").removeAttr("disabled");
            $("#right-sel-cont").find("select").removeAttr("disabled");

            $("#Check_start").removeAttr("disabled");

        }

        //禁用左侧的扫描框
        function allDisabled() {
            $("#left_content").attr("title", "请选择右侧的下拉菜单然后点击“开始盘点”以激活当前区域");
            $("#ScanNumber").val("");
            $("#left_content label").html("");
            $("#left_content").removeClass("enabled_all_conte").addClass("disable_all_conte");
            $("#ScanNumber").attr("disabled", "disabled");
            $("#count_but_li a").removeAttr("href");
            $("#count_but_li div").attr("disabled", "disabled");
            $("#Check_ok").attr("disabled", "disabled");//"禁用‘确认盘点’按钮"
        }

        //启用左侧的扫描框
        function allEnabled() {
            $("#left_content").removeClass("disable_all_conte").addClass("enabled_all_conte");
            $("#left_content input").removeAttr("disabled");
            $("#count_but_li a").attr("href", "javascript:void(0)");
            $("#count_but_li div").removeAttr("disabled");
            var magtop = $("#content-wrapper").css("margin-top");
            var mt = $("#content-wrapper .panel-dark").css("margin-top").replace("px", "");
            var atr = $("#content-wrapper .panel-dark").attr("margatr");
            var mtp = parseInt(mt);
            var newtp;
            if (atr != undefined && atr == "p") {
                newtp = (mtp - 1) + "px";
                $("#content-wrapper .panel-dark").css("margin-top", newtp).attr("margatr", "c");
            }
            else {
                newtp = (mtp + 1) + "px";
                $("#content-wrapper .panel-dark").css("margin-top", newtp).attr("margatr", "p");
            }



            //$("#content-wrapper").css("margin-top", tp);
            /*
            function () {
               $("#content-wrapper").animate({ "margin-top": "0px" }, 100);
           }
            */
        }

        //设置显示文本
        function setText(sender, val) {
            $(sender).animate({
                opacity: '0.3',
            }, "slow").animate({
                opacity: '1'
            }, "first", function () {
                $(sender).text(val);
            });
        }

        //初始化盘点参数
        function initSelectParams(sender, val) {
            if (val != null && val != "" && val != 0 && val != undefined && val > 0) {
                $(sender).each(function () {
                    var num = $(this).val();
                    if (num == val) {
                        $(this).attr("selected", "selected");
                    }
                });
            }
        }

        //初始化仓库
        function initStorage(StoreId, StorageId) {
            ;
            $("#StorageId").html("");
            if (StoreId != "" && StoreId != "-1") {
                var storeId = parseInt(StoreId);
                $.post("@Url.Action("GetStorages", "Storage")", { storeId: storeId }, function (da) {
                    if (da != "" && da != null && da != undefined) {
                        //Id = c.Id, Name = c.StorageName, IsDefault = c.IsDefaultStorage
                        var t = "";
                        for (var i = 0; i < da.length; i++) {
                            var id = da[i].Value;
                            var name = da[i].Text;
                            if (id == StorageId)
                                t += "<option value=" + id + " selected='selected'>" + name + "</option>";
                            else {
                                t += "<option value=" + id + ">" + name + "</option>";
                            }
                        }
                        $("#StorageId").html("").html(t);
                          $('.cur_selectpicker').selectpicker();
       					 $('.cur_selectpicker').selectpicker('refresh');
                    }
                });
            }
        }

        //初始化尺码
        function initSize(CategoryId, SizeID) {
            if (CategoryId == null || CategoryId == "" || CategoryId == undefined) {
                return false;
            } else {
                $.post("@Url.Action("GetSizeOfCategory")", { id: CategoryId }, function (da) {
                    if (da != "") {
                        var opts = "<option value=''>下拉选择尺码</option>";
                        for (var i = 0; i < da.length; i++) {
                            var id = da[i].Value;
                            var name = da[i].Text;
                            if (id == SizeID) {
                                opts += "<option value='" + id + "'  selected='selected'>" + name + "</option>";
                            } else {
                                opts += "<option value='" + id + "'>" + name + "</option>";
                            }
                        }
                        $("#SizeID").html("").html(opts);
                        $('.cur_selectpicker').selectpicker();
       					 $('.cur_selectpicker').selectpicker('refresh');
                    }
                });
            }
        }

        //将表单数据序列化成Json数据
        function serializeForm() {
            var o = {};
            var a = $("#form_dat_righ").serializeArray();
            $.each(a, function () {
                if (o[this.name] !== undefined) {
                    if (!o[this.name].push) {
                        o[this.name] = [o[this.name]];
                    }
                    o[this.name].push(this.value || '');
                } else {
                    o[this.name] = this.value || '';
                }
            });
            return o;
        }

        //批量
        function select_check_Access() {
            var checkerId = $("#checkerId").val();
            var orderblankNumber = $("#OrderblankNumber").val();
            $.post('@Url.Action("ExcelBatchStrageCheck")', { Id: checkerId, orderblankNumber: orderblankNumber }, function (da) {
                //refrshValidDat(da);
                if (da.ResultType == "@((int)OperationResultType.Success)") {
                    var entity = da.Data;
                    var CheckQuantity = entity.CheckQuantity;
                    var CheckedQuantity = entity.CheckedQuantity;
                    var ValidQuantity = entity.ValidQuantity;
                    var InvalidQuantity = entity.InvalidQuantity;
                    var MissingQuantity = entity.MissingQuantity;
                    var ResidueQuantity = entity.ResidueQuantity;
                    //初始化盘点数据
                    setText($("#checkCount"), MissingQuantity);
                    setText($("#checkedCount"), CheckedQuantity);
                    setText($("#validCount"), ValidQuantity);
                    setText($("#invalidCount"), InvalidQuantity);
                    setText($("#missingCount"), MissingQuantity);
                    setText($("#residueCount"), ResidueQuantity);
                    $.whiskey.datatable.reset(true);
                }

            });
        }

        //查看盘点详情
        function showDetail(checkerItemType) {

            var view = new $.whiskey.web.ajaxView({
                caption: "数据列表",
                actionUrl: "@Url.Action("CheckerDetail")",
                params: { CheckerItemType: checkerItemType },
                //lockButton: $(sender),
            });
        }

        function initParamsCount(entity) {

            var Id = entity.Id;
            var StoreId = entity.StoreId;
            var StorageId = entity.StorageId;
            var BrandId = entity.BrandId;
            var CategoryId = entity.CategoryId;
            var SeasonId = entity.SeasonId;
            var SizeID = entity.SizeID;
            var ColorId = entity.ColorId;
            var CreateTime = entity.CreatedTime;
            var CheckQuantity = entity.CheckQuantity;
            var CheckedQuantity = entity.CheckedQuantity;
            var ValidQuantity = entity.ValidQuantity;
            var InvalidQuantity = entity.InvalidQuantity;
            var MissingQuantity = entity.MissingQuantity;
            var ResidueQuantity = entity.ResidueQuantity;
            var Notes = entity.Notes;

            setText($("#checkCount"), MissingQuantity);
            setText($("#checkedCount"), CheckedQuantity);
            setText($("#validCount"), ValidQuantity);
            setText($("#invalidCount"), InvalidQuantity);
            setText($("#missingCount"), MissingQuantity);
            setText($("#residueCount"), ResidueQuantity);

            //初始化盘点数据
            $("#checkerId").attr("value", Id);
            //初始化盘点参数
            initSelectParams($("#StoreId"), StoreId)
            initSelectParams($("#StorageId"), StorageId)
            initSelectParams($("#BrandId"), BrandId)
            initSelectParams($("#SeasonId"), SeasonId)
            initSelectParams($("#ColorId"), ColorId)
            //初始化仓库
            initStorage(StoreId, StorageId);
            initSize(CategoryId, SizeID);
            $("#Notes").attr("value", Notes);
        }
    </script>
    <script>
    // selectpicker 初始化
    $(function () {
        
    })
</script>
}



