<style>
    .view-item {
    cursor: pointer;
    background: #4c94c8;
    padding: 4px 5px;
    border-radius: 3px;
    }
    .button_line{
	  font-size: 12px;

    padding: .2em .2em !important;
    white-space: nowrap;
    border-radius: .25em;
	}
		.button_line:hover{
			 cursor: pointer;
		}
</style>
<div class="row">
    <div class="panel panel-search">
        <div class="panel-heading clearfix">
            <div class="col-md-4 panel-title">
                <h5><i class="fa fa-search"></i> <span>查询条件</span></h5>
            </div>
            <div class="col-md-8 text-right">
                <input class="switcher" type="checkbox" data-class="switcher-default" checked="checked">
            </div>
        </div>
        <div class="panel-body">
            <form class="form-horizontal form-search">
                <div class="col-md-10">
                    <div class="form-group no-margin-hr">
                        <label class="control-label col-md-4">会员编号\手机号\卡号</label>
                        <div class="col-md-6">
                            @Html.TextBox("NumberOrCode", "", new { @class = "form-control", placeholder = "请输入会员编号\\手机号\\会员卡号" })
                        </div>
                    </div>
                </div>

            </form>
        </div>
        <div class="panel-footer text-right clearfix ">
            <div class="pull-left">
                <button id="Search" title="按条件搜索数据" type="button" class="btn btn-primary btn-padding-right"><i class="fa fa-search"></i> <span>搜索</span></button>
                <button id="Clear" title="重置搜索栏的各项输入" type="button" class="btn btn-default btn-padding-right"><i class="fa fa-refresh"></i> <span>清除</span></button>
            </div>

            <div class="pull-right">
                <div class="button-normal">
                    <button id="Create" title="新增会员" type="button" class="btn btn-success btn-padding-right"><i class="fa fa-plus"></i> <span>新增会员</span></button>
                    <button id="Print" title="打印预览" type="button" class="btn btn-facebook btn-padding-right"><i class="fa fa-print"></i> <span>打印预览</span></button>
                    <button id="Export" title="导出文件" type="button" class="btn btn-warning btn-padding-right"><i class="fa fa-save"></i> <span>导出文件</span></button>
                    <button id="RemoveAll" title="将选择的项移至回收站" type="button" class="btn btn-danger btn-padding-right"><i class="fa fa-remove"></i> <span>移除所选</span></button>
                </div>
                <div class="button-recycle">

                </div>
            </div>

        </div>
    </div>
</div>

<div class="row">
    <div class="panel panel-list">
        <div class="panel-heading clearfix">
            <div class="col-md-2 panel-title">
                <h5><i class="fa fa-list"></i> <span>会员基本信息</span></h5>
            </div>
        </div>
        <table class="table table-list-meminfo table-hover valign-middle" width="100%">
            <thead>

            </thead>
        </table>
    </div>
</div>
<div class="row">
    <div class="panel panel-list">
        <div class="panel-heading clearfix">
            <div class="col-md-2 panel-title">
                <h5><i class="fa fa-list"></i> <span>最近5次消费记录</span></h5>
            </div>
        </div>
        <table class="table table-list-consum table-hover valign-middle" width="100%">
            <thead>
            </thead>
        </table>
    </div>
</div>
<div class="row">
    <div class="panel panel-list">
        <div class="panel-heading clearfix">
            <div class="col-md-2 panel-title">
                <h5><i class="fa fa-list"></i> <span>最近5次储值记录</span></h5>
            </div>
        </div>
        <table class="table table-list-balan table-hover valign-middle" width="100%">
            <thead>
            </thead>
        </table>
    </div>
</div>
<div class="row">
    <div class="panel panel-list">
        <div class="panel-heading clearfix">
            <div class="col-md-2 panel-title">
                <h5><i class="fa fa-list"></i> <span>最近5次积分记录</span></h5>
            </div>
        </div>
        <table class="table table-list-score table-hover valign-middle" width="100%">
            <thead>
            </thead>
        </table>
    </div>
</div>



<link href="/content/styles/jquery/jquery.treegrid.css" rel="stylesheet" />
<script src="/content/scripts/jquery/treegrid/jquery.treegrid.js"></script>
<script src="/content/scripts/jquery/treegrid/jquery.treegrid.bootstrap3.js"></script>
@section Scripts{

    <script type="text/javascript">
        function showRetailInfo(sender) {
            var url = "@Url.Action("PView","RetailDetail")";
            var retailNumber = $(sender).data("retailnumber");
            var view = new $.whiskey.web.ajaxView({
                caption: "详细信息",
                actionUrl: url,
                params: { retailNumber: retailNumber, showDetail: true }
            });
        }

        $(document).ready(function () {




            //会员基本信息
            $.whiskey.datatable.instances[0] = $(".table-list-meminfo").dataTable({
                "sDom": "",
                "bPaginate": true,
                "bFilter": true,
                "bLengthChange": 20,
                "bScrollCollapse": false,
                "sAjaxSource": "@Url.Action("List")",
                "fnServerData": function (sSource, aoData, fnCallback) {
                    $.ajax({
                        "dataType": 'json',
                        "type": "POST",
                        "url": sSource,
                        "data": aoData,
                        //"success": fnCallback,
                        "beforeSend": function () {
                            var code = $("#NumberOrCode").val().trim();
                            if (code == "") {
                                $(".dataTables_processing").hide();
                                return false;
                            }
                        },
                        success: function (data) {
                            if (data.aaData.length == 0) {
                                $.whiskey.web.alert({
                                    type: "info",
                                    content: "会员不存在"
                                });
                                return false;
                            }
                            fnCallback(data);
                        }
                    });
                },
                "fnServerParams": function (aoData) {
                    var conditions = new $.whiskey.filter.group();
                    var code = $("#NumberOrCode").val().trim();
                    var group = new $.whiskey.filter.group();
                    group.Rules.push(new $.whiskey.filter.rule("UniquelyIdentifies", code, "equal"));
                    group.Rules.push(new $.whiskey.filter.rule("MobilePhone", code, "equal"));
                    group.Rules.push(new $.whiskey.filter.rule("CardNumber", code, "equal"));
                    group.Operate = "Or";
                    conditions.Groups.push(group);
                    aoData.push({ name: "conditions", value: JSON.stringify(conditions) });
                },

                "fnRowCallback": function (nRow, aData, iDisplayIndex) {
                    $("td", nRow).css({ "text-align": "center" });
                    $("th").css({ "text-align": "center" });
                    return nRow;
                },
                "fnDrawCallback": function (osetting) {
                    $(".checked-all").click(function () {
                        var checkedStatus = this.checked;
                        $(".table tr td input[type=checkbox]").each(function () {
                            this.checked = checkedStatus;
                        });
                    });
                    $(".table tr td input[type=checkbox]").checked = true;
                    $(".treegrid-expander").css({ "margin-left": 0, "float": "left" });
                },
                "aoColumns": [
                    {
                        "bVisible": false,
                        "bSearchable": false,
                        "sName": "Id",
                        "mData": "Id"
                    },
                    {
                        "sTitle": $.whiskey.datatable.tplTitleCheckbox(),
                        "sName": "Id",
                        "bSortable": false,
                        "bSearchable": false,
                        "mData": function (data) {
                            return $.whiskey.datatable.tplListCheckbox(data.Id);
                        }
                    },

                    {
                        "sTitle": "会员编号",
                        "bSortable": false,
                        "sName": "ProductId",
                        "mData": function (data) {
                            return data.UniquelyIdentifies;
                        }
                    },
                     {
                         "sTitle": "会员卡号",
                         "bSortable": false,
                         "sName": "ProductId",
                         "mData": function (data) {
                             return data.CardNumber;
                         }
                     },
                    {
                        "sTitle": "会员名",
                        "bSortable": false,
                        "sName": "StorageId",
                        "mData": function (data) {
                            return data.RealName;
                        },
                    },
                      {
                          "sTitle": "性别",
                          "bSortable": false,
                          "sName": "StorageId",
                          "mData": function (data) {
                              return data.Gender==1?"男":"女";
                          },
                      },
                    {
                        "sTitle": "图片",
                        "bSortable": false,
                        "sName": "StorageId",
                        "mData": function (data) {
                            return "<img width='50px' src=" + data.UserPhoto + " style='border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;'>";
                        },
                    },
                    {
                        "sTitle": "电话",
                        "bSortable": false,
                        "sName": "StorageId",
                        "mData": function (data) {
                            return data.MobilePhone;
                        },
                    },
                    {
                        "sTitle": "归属",
                        "bSortable": false,
                        "sName": "StorageId",
                        "mData": function (data) {
                            if (data.StoreName)
                                return data.StoreName;
                            return "<a href='javascript:void(0);'  onclick='GetStore(" + data.Id + ");'>设置</a>";
                        },
                    },
                      {
                          "sTitle": "级别",
                          "bSortable": false,
                          "sName": "StorageId",
                          "mData": function (data) {     
                              
                              var tex = '<labl class="label label-info view-memeb" style="cursor:pointer" onclick="updateMemberType(' + data.Id + ',this)">' + data.MemberTypeName + '</labl>';
                              return tex;
                          },
                      },
                    {
                        "sTitle": "储值",
                        "bSortable": false,
                        "sName": "StorageId",
                        "mData": function (data) {
                            return data.Balance;
                        },
                    },
                    {
                        "sTitle": "积分",
                        "bSortable": false,
                        "sName": "StorageId",
                        "mData": function (data) {
                            return data.Score;
                        },
                    },
                      {
                          "sTitle": "入会时间",
                          "bSortable": false,
                          "sName": "StorageId",
                          "mData": function (data) {
                              return $.whiskey.tools.dateFormat(data.CreatedTime)
                              ;
                          },
                      },
                      {
                          "sTitle": "控制操作",
                          "bSortable": false,
                          "bSearchable": false,
                          "mData": function (data) {
                              //var controller = '<button   title="在线充值" type="button" class="btn-padding-right fa-zxcz " onclick="RechargeWx(this,' + data.Id + ')"></button>';
                              var controller = "<button id=\"btn-recharge\"   title=\"充值\" type=\"button\"  onclick=\"Recharge(this,'" + data.Id + "');\" class=\"btn-padding-right fa-cz\"> </button>";
                              controller += "<button id=\"btn-update-pass\"   title=\"修改密码\" type=\"button\"  onclick=\"UpdatePass(this,'" + data.Id + "');\" class=\"btn-padding-right fa-xgmm\"></button>";
                              controller += "<button id=\"btn-apply-adjust\"   title=\"申请修改储值积分\" type=\"button\"  onclick=\"ChangeRecharge(this,'" + data.Id + "');\" class=\"btn-padding-right fa-ccjf\"></button>";
                              controller += "<button id=\"btn-push\"  title=\"推送搭配\"  type=\"button\"  onclick=\"pushRecommend(' "+ data.Id +"')\"  class=\"btn-opt-box btn-padding-right \">   <i class=\"btn-pushs-icon\"></i> </button>";

                              //   controller += $.whiskey.datatable.tplRecharge(data.Id);
                              //   controller += $.whiskey.datatable.tplPass(data.Id);
                              //   controller += $.whiskey.datatable.tplChangeRecharge(data.Id);

                              return controller;
                          }
                      }
                ]

            });

            //会员最近5次的消费记录
            $.whiskey.datatable.instances[1] = $(".table-list-consum").dataTable({
                "sDom": "",
                "bPaginate": true,
                "bFilter": true,
                "bLengthChange": 20,
                "bScrollCollapse": false,
                "sAjaxSource": "@Url.Action("ConsumeOrderList")",
                "fnServerData": function (sSource, aoData, fnCallback) {
                    $.ajax({
                        "dataType": 'json',
                        "type": "POST",
                        "url": sSource,
                        "data": aoData,
                        "success": fnCallback,
                        "beforeSend": function () {
                            var code = $("#NumberOrCode").val().trim();
                            if (code == "") {
                                $(".dataTables_processing").hide();
                                return false;
                            }
                        },
                    });
                },
                "fnServerParams": function (aoData) {
                    var conditions = new $.whiskey.filter.group();
                    var code = $("#NumberOrCode").val().trim();
                    var group = new $.whiskey.filter.group();
                    group.Rules.push(new $.whiskey.filter.rule("Consumer.UniquelyIdentifies", code, "equal"));
                    group.Rules.push(new $.whiskey.filter.rule("Consumer.MobilePhone", code, "equal"));
                    group.Rules.push(new $.whiskey.filter.rule("Consumer.CardNumber", code, "equal"));
                    group.Operate = "Or";
                    conditions.Groups.push(group);
                    aoData.push({ name: "conditions", value: JSON.stringify(conditions) });
                },

                "fnRowCallback": function (nRow, aData, iDisplayIndex) {
                    $("td:eq(1)", nRow).addClass("button_line");
                    $("td", nRow).css({ "text-align": "center" });
                    return nRow;
                },
                "fnDrawCallback": function (osetting) {

                    $(".checked-all").click(function () {
                        var checkedStatus = this.checked;
                        $(".table tr td input[type=checkbox]").each(function () {
                            this.checked = checkedStatus;
                        });

                    });
                    $(".table tr td input[type=checkbox]").checked = true;
                    $(".treegrid-expander").css({ "margin-left": 0, "float": "left" });
                },
                "aoColumns": [
                    {
                        "bVisible": false,
                        "bSearchable": false,
                        "sName": "Id",
                        "mData": "Id"
                    },
                    {
                        "sTitle": $.whiskey.datatable.tplTitleCheckbox(),
                        "sName": "Id",
                        "bSortable": false,
                        "bSearchable": false,
                        "mData": function (data) {
                            return $.whiskey.datatable.tplListCheckbox(data.Id);
                        }
                    },

                    {
                        "sTitle": "消费编号",
                        "bSortable": false,
                        "sName": "ProductId",
                        "mData": function (data) {
                            return '<span class="view-item" data-retailnumber="'+data.RetailNumber+'" onclick="showRetailInfo(this)">'+data.RetailNumber+'</span>';
                        }
                    },
                     {
                         "sTitle": "消费店铺",
                         "bSortable": false,
                         "sName": "ProductId",
                         "mData": function (data) {
                             return data.StoreName;
                         }
                     },

                    {
                        "sTitle": "消费总额(￥)",
                        "bSortable": false,
                        "sName": "ProductId",
                        "mData": function (data) {
                            return data.ConsumeCount;
                        }
                    },

                    {
                        "sTitle": "储值消费(￥)",
                        "bSortable": false,
                        "sName": "ProductId",
                        "mData": function (data) {
                            return data.Balance;
                        }
                    },

                    {
                        "sTitle": "积分消费",
                        "bSortable": false,
                        "sName": "ProductId",
                        "mData": function (data) {
                            return data.ScoreConsume;
                        }
                    },
                    {
                        "sTitle": "刷卡消费(￥)",
                        "bSortable": false,
                        "sName": "ProductId",
                        "mData": function (data) {
                            return data.SwipeConsume;
                        }
                    },
                    {
                        "sTitle": "现金消费(￥)",
                        "bSortable": false,
                        "sName": "ProductId",
                        "mData": function (data) {
                            return data.CashConsume;
                        }
                    },
                    {
                        "sTitle": "剩余储值(￥)",
                        "bSortable": false,
                        "sName": "ProductId",
                        "mData": function (data) {
                            return data.RemainValue;
                        }
                    },
                     {
                         "sTitle": "剩余积分",
                         "bSortable": false,
                         "sName": "ProductId",
                         "mData": function (data) {
                             return data.RemainScore;
                         }
                     },
                      {
                          "sTitle": "消费时间",
                          "bSortable": false,
                          "sName": "ProductId",
                          "mData": function (data) {
                              return $.whiskey.tools.dateFormat(data.CreatedTime, "yyyy-MM-dd HH:mm")
                              ;
                          }
                      },
                ]

            });

            //会员最近5次的储值记录
            $.whiskey.datatable.instances[2] = $(".table-list-balan").dataTable({
                "sDom": "",
                "bPaginate": true,
                "bFilter": true,
                "bLengthChange": 20,
                "bScrollCollapse": false,
                "sAjaxSource": "@Url.Action("BalanceOrderList")",
                "fnServerData": function (sSource, aoData, fnCallback) {
                    $.ajax({
                        "dataType": 'json',
                        "type": "POST",
                        "url": sSource,
                        "data": aoData,
                        "success": fnCallback,
                        "beforeSend": function () {
                            var code = $("#NumberOrCode").val().trim();
                            if (code == "") {
                                $(".dataTables_processing").hide();
                                return false;
                            }
                        },
                    });
                },
                "fnServerParams": function (aoData) {
                    var conditions = new $.whiskey.filter.group();
                    var code = $("#NumberOrCode").val().trim();
                    var group = new $.whiskey.filter.group();
                    group.Rules.push(new $.whiskey.filter.rule("Member.UniquelyIdentifies", code, "equal"));
                    group.Rules.push(new $.whiskey.filter.rule("Member.MobilePhone", code, "equal"));
                    group.Rules.push(new $.whiskey.filter.rule("Member.CardNumber", code, "equal"));
                    group.Operate = "Or";
                    conditions.Groups.push(group);
                    aoData.push({ name: "conditions", value: JSON.stringify(conditions) });
                },

                "fnRowCallback": function (nRow, aData, iDisplayIndex) {
                    $("td", nRow).css({ "text-align": "center" });
                    return nRow;
                },
                "fnDrawCallback": function (osetting) {

                    $(".checked-all").click(function () {
                        var checkedStatus = this.checked;
                        $(".table tr td input[type=checkbox]").each(function () {
                            this.checked = checkedStatus;
                        });

                    });
                    $(".table tr td input[type=checkbox]").checked = true;
                    $(".treegrid-expander").css({ "margin-left": 0, "float": "left" });
                },
                "aoColumns": [
                    //{
                    //    "sTitle": "会员编号",
                    //    "bSortable": false,
                    //    "sName": "ProductId",
                    //    "mData": function (data) {
                    //        return data.MemberNumb;
                    //    }
                    //},
                    {
                        "sTitle": "变动类型",
                        "bSortable": false,
                        "sName": "StorageId",
                        "mData": function (data) {
                            return data.Type;
                        },
                    },

                    {
                        "sTitle": "变动前储值(￥)",
                        "bSortable": false,
                        "sName": "StorageId",
                        "mData": function (data) {
                            return data.BeforeBalance;
                        },
                    },
                    {
                        "sTitle": "变动后储值(￥)",
                        "bSortable": false,
                        "sName": "StorageId",
                        "mData": function (data) {
                            return data.AfterBalance;
                        },
                    },
                     {
                         "sTitle": "变动时间",
                         "bSortable": false,
                         "sName": "StorageId",
                         "mData": function (data) {
                             return $.whiskey.tools.dateFormat(data.CreateTime, "yyyy-MM-dd HH:mm");
                         },
                     },
                      {
                          "sTitle": "操作人",
                          "bSortable": false,
                          "sName": "StorageId",
                          "mData": function (data) {
                              return data.Operator;
                          },
                      },
                ]
            });

            //会员最近5次的积分记录
            $.whiskey.datatable.instances[3] = $(".table-list-score").dataTable({
                "sDom": "",
                "bPaginate": true,
                "bFilter": true,
                "bLengthChange": 20,
                "bScrollCollapse": false,
                "sAjaxSource": "@Url.Action("ScoreOrderList")",
                "fnServerData": function (sSource, aoData, fnCallback) {
                    $.ajax({
                        "dataType": 'json',
                        "type": "POST",
                        "url": sSource,
                        "data": aoData,
                        "success": fnCallback,
                        "beforeSend": function () {
                            var code = $("#NumberOrCode").val().trim();
                            if (code == "") {
                                $(".dataTables_processing").hide();
                                return false;
                            }
                        },
                    });
                },
                "fnServerParams": function (aoData) {
                    var conditions = new $.whiskey.filter.group();
                    var code = $("#NumberOrCode").val().trim();
                    var group = new $.whiskey.filter.group();
                    group.Rules.push(new $.whiskey.filter.rule("Member.UniquelyIdentifies", code, "equal"));
                    group.Rules.push(new $.whiskey.filter.rule("Member.MobilePhone", code, "equal"));
                    group.Rules.push(new $.whiskey.filter.rule("Member.CardNumber", code, "equal"));
                    group.Operate = "Or";
                    conditions.Groups.push(group);
                    aoData.push({ name: "conditions", value: JSON.stringify(conditions) });
                },

                "fnRowCallback": function (nRow, aData, iDisplayIndex) {
                    $("td", nRow).css({ "text-align": "center" });
                    return nRow;
                },
                "fnDrawCallback": function (osetting) {

                    $(".checked-all").click(function () {
                        var checkedStatus = this.checked;
                        $(".table tr td input[type=checkbox]").each(function () {
                            this.checked = checkedStatus;
                        });

                    });
                    $(".table tr td input[type=checkbox]").checked = true;
                    $(".treegrid-expander").css({ "margin-left": 0, "float": "left" });
                },
                "aoColumns": [
                      //{
                      //    "sTitle": "会员编号",
                      //    "bSortable": false,
                      //    "sName": "ProductId",
                      //    "mData": function (data) {
                      //        return data.MemberNumb;
                      //    }
                      //},
                      {
                          "sTitle": "变动类型",
                          "bSortable": false,
                          "sName": "StorageId",
                          "mData": function (data) {
                              return data.Type;
                          },
                      },

                      {
                          "sTitle": "变动前积分",
                          "bSortable": false,
                          "sName": "StorageId",
                          "mData": function (data) {
                              return data.BeforeScore;
                          },
                      },
                      {
                          "sTitle": "变动后积分",
                          "bSortable": false,
                          "sName": "StorageId",
                          "mData": function (data) {
                              return data.AfterScore;
                          },
                      },
                       {
                           "sTitle": "变动时间",
                           "bSortable": false,
                           "sName": "StorageId",
                           "mData": function (data) {
                               return $.whiskey.tools.dateFormat(data.CreateTime, "yyyy-MM-dd HH:mm");
                           },
                       },
                        {
                            "sTitle": "操作人",
                            "bSortable": false,
                            "sName": "StorageId",
                            "mData": function (data) {
                                return data.Operator;
                            },
                        },

                ]
            });

            $("#NumberOrCode").keydown(function (e) {
                if (e.keyCode == 13) {
                    $("#Search").click();
                    return false;
                }
            });

            $("#Print").on("click", function () {
                var list = $.whiskey.web.getIdByChecked(".table-list td input[type=checkbox]");
                if (list.length > 0) {
                    var printer = $.whiskey.printer.ajaxPreview({
                        actionUrl: "@Url.Action("Print")",
                        lockButton: $(this),
                        topMargin: "2%",
                        leftMargin: "4%",
                        contentWidth: "93.5%",
                        contentHeight: "100%",
                        params: list
                    });
                } else {
                    $.whiskey.web.alert({
                        type: "info",
                        content: "请至少选择一条数据！",
                        callback: function () {
                        }
                    });
                }
            });

            $("#Create").on("click", function () {
                var dialog = new $.whiskey.web.ajaxDialog({
                    caption: "创建数据",
                    actionUrl: "@Url.Action("Create")",
                    lockButton: $(this),
                    formValidator: function () {
                        var $form = $(".modal-form");
                        if (!$form.valid()) {
                            return false;
                        } else {
                            return true;
                        }
                    },
                    postComplete: function () {
                        $.whiskey.datatable.reset(false);
                        return true;
                    },
                });
            });

            $("#Export").on("click", function () {
                var list = $.whiskey.web.getIdByChecked(".table-list td input[type=checkbox]");
                if (list.length > 0) {
                    var printer = $.whiskey.exporter.ajaxExport({
                        actionUrl: "@Url.Action("Export")",
                        lockButton: $(this),
                        fileName: "新导出文件",
                        topMargin: 10,
                        leftMargin: 10,
                        contentWidth: "98%",
                        contentHeight: "100%",
                        params: list
                    });
                } else {
                    $.whiskey.web.alert({
                        type: "info",
                        content: "请至少选择一条数据！",
                        callback: function () {
                        }
                    });
                }
            });

            $("#RemoveAll").on("click", function () {
                var list = $.whiskey.web.getIdByChecked(".table-list td input[type=checkbox]");
                if (list.length > 0) {
                    var confirm = new $.whiskey.web.ajaxConfirm({
                        question: "确认要将这些数据移至回收站吗？",
                        notes: "提示：数据移动到回收站后，随时可以从回收站中将其恢复",
                        actionUrl: "@Url.Action("Remove")",
                        params: list,
                        complete: function () {
                            $.whiskey.datatable.reset(false);
                        }
                    });
                } else {
                    $.whiskey.web.alert({
                        type: "info",
                        content: "请至少选择一条数据！",
                        callback: function () {
                        }
                    });
                }
            });

            $("#RecoveryAll").on("click", function () {
                var list = $.whiskey.web.getIdByChecked(".table-list td input[type=checkbox]");
                if (list.length > 0) {
                    var confirm = new $.whiskey.web.ajaxConfirm({
                        question: "确认要将这些数据恢复吗？",
                        notes: "提示：将数据从回收站移动至正常数据列表里",
                        actionUrl: "@Url.Action("Recovery")",
                        params: list,
                        complete: function () {
                            $.whiskey.datatable.reset(false);
                        }
                    });
                } else {
                    $.whiskey.web.alert({
                        type: "info",
                        content: "请至少选择一条数据！",
                        callback: function () {
                        }
                    });
                }
            });

            $("#Search").on("click", function () {
                $.whiskey.datatable.reset(false, $.whiskey.datatable.instances[0]);
                $.whiskey.datatable.reset(false, $.whiskey.datatable.instances[1]);
                $.whiskey.datatable.reset(false, $.whiskey.datatable.instances[2]);
                $.whiskey.datatable.reset(false, $.whiskey.datatable.instances[3]);
            }).click();

            $("#Clear").on("click", function () {
                $.whiskey.web.clearForm(".form-search");
            });


        });
         function pushRecommend(memberId) {
            var dialog = new $.whiskey.web.ajaxDialog({
                caption: "创建数据",
                actionUrl: "@Url.Action("MemberCollocationSelect")",
                lockButton: $(this),
                formValidator: function () {
                 
                    vmRecommendMember.save();
                    return false;
                },
                getParams: { memberId: memberId },
                postComplete: function () {
                    $.whiskey.datatable.reset(false);
					return true;
                },
            });
        }

        function parView(send) {
            var num = $(send).parents("tr:eq(0)").find("td:eq(2)").text();
            var view = new $.whiskey.web.ajaxView({
                caption: "详细信息",
                actionUrl: "@Url.Action("View")",
                params: { PrNum: num },
                lockButton: $(this),
            });
        }
        //修改密码
        function UpdatePass(sender, Id) {
            var dialog = new $.whiskey.web.ajaxDialog({
                caption: "修改密码",
                actionUrl: "@Url.Action("UpdatePass")",
                getParams: { Id: Id },
                lockButton: $(sender),
                formValidator: function () {
                    var $form = $(".modal-form");
                    if (!$form.valid()) {
                        return false;
                    } else {
                        return true;
                    }
                },
                postComplete: function () {
                    $.whiskey.datatable.reset(true);
                    return true;
                },
            });
        }
        //充值
        function Recharge(sender, Id) {
            var dialog = new $.whiskey.web.ajaxDialog({
                caption: "充值",
                actionUrl: "@Url.Action("Recharge")",
                getParams: { Id: Id },
                lockButton: $(sender),
                formValidator: function () {
                    var $form = $(".modal-form");
                    if (!$form.valid()) {
                        return false;
                    } else {
                        //return true;
                        var postData = $form.serialize();

                        //console.log(postData);
                        $.post("@Url.Action("Recharge")", postData, function (res) {
                            //console.log(res);
                            if (res.ResultType == 3) {
                                // 关闭浮层
                                var memberId = $("#MemberId").val();
                                $(".bootbox-close-button").click();

                                // 弹出是否打印小票的框
                                var confirm = new $.whiskey.web.ajaxConfirm({
                                    question: "操作成功",
                                    notes: "提示：会员充值完成，是否打印小票？",
                                    lockButton: $(sender),
                                    success_event: function () {
                                        //打印小票
                                        var view = new $.whiskey.web.ajaxView({
                                            caption: "打印购物凭证",
                                            actionUrl: "@Url.Action("PrintMemberLatestRechargeReceip")",
                                            params: { memberId: memberId }
                                        });
                                    },
                                    cancel_event: function () {
                                        //alert("未实现");
                                        $.whiskey.datatable.reset(true);
                                    }
                                });
                            } else {
                                $.whiskey.web.alert({
                                    type: "info",
                                    content: res.Message + ",请更正"
                                });
                            }
                        }, "json");//end post
                        return false;
                        //$.post('@Url.Action("Recharge")')
                    }
                },
                postComplete: function () {
                    $.whiskey.datatable.reset(true);
                    return true;
                },
            });
        }

        //储值和积分调整
        function ChangeRecharge(sender, Id) {
            var dialog = new $.whiskey.web.ajaxDialog({
                caption: "储值和积分调整",
                actionUrl: "@Url.Action("AdjustDeposit")",
                getParams: { Id: Id },
                lockButton: $(sender),
                formValidator: function () {
                    var $form = $(".modal-form");
                    if (!$form.valid()) {
                        return false;
                    } else {
                        if ($("#Reason").val() != "") {
                            if (parseFloat($("#Balance").val()) == 0 && parseFloat($("#Score").val()) == 0) {
                                $.whiskey.web.alert({
                                    type: "info",
                                    content: "储值和积分减少不能同时为0"
                                });
                                return false;
                            } else {
                                var disBlance = parseFloat($("#disBlance").val());
                                var disScore = parseFloat($("#disScore").val());
                                var blance = parseFloat($("#Balance").val());
                                var score = parseFloat($("#Score").val());
                                var IsBalancePlus = $("#IsBalancePlus").val();
                                var IsScorePlus = $("#IsScorePlus").val();
                                if (IsBalancePlus != "true" && blance > disBlance) {
                                    $.whiskey.web.alert({
                                        type: "info",
                                        content: "减少储值大于账户储值余额"
                                    });
                                    return false;
                                }
                                if (IsScorePlus != "true" && score > disScore) {
                                    $.whiskey.web.alert({
                                        type: "info",
                                        content: "减少积分大于账户积分余额"
                                    });
                                    return false;
                                }
                                return true;
                            }
                        } else {
                            $.whiskey.web.alert({
                                type: "info",
                                content: "调整原因不能为空"
                            });
                            return false;
                        }
                    }
                },
                postComplete: function () {
                    $.whiskey.datatable.reset(true);
                    return true;
                },
            });
        }

        function updateMemberType(memberId, sender) {
            var dialog = new $.whiskey.web.ajaxDialog({
                caption: "会员等级",
                actionUrl: "@Url.Action("MemberType")",
                getParams: { Id: memberId },
                lockButton: $(sender),
                formValidator: function () {
                    var $form = $(".modal-form");
                    if (!$form.valid()) {
                        return false;
                    } else {
                        return true;
                    }
                },
                postComplete: function () {
                    $.whiskey.datatable.reset(true, $.whiskey.datatable.instances[0]);
                    return true;
                },
            });
        }
        function GetStore(Id) {
            $.whiskey.ajaxLoading({
                url: "@Url.Action("StoreList", "Member", new { area = "Members" })",
                data: { origin: "memberseach_index", memberId: Id },
                type: 'get',
                success: function (data) {
                    bootbox.dialog({
                        message: data,
                        // message:formBody,
                        title: "店铺列表",
                        buttons: {
                            cancel: {
                                label: "关闭",
                                icon: "fa-close",
                                className: "btn-default",
                                callback: function () {
                                    $.whiskey.datatable.reset(true, $.whiskey.datatable.instances[0]);
                                }
                            }
                        }
                    });
                }
            });
        }

        function RechargeWx(sender, Id) {
            var dialog = new $.whiskey.web.ajaxDialog({
                caption: "充值",
                actionUrl: "/Members/MemberDeposit/RechargeWx",
                lockButton: $(this),
                diacl: 'RechargeDialog',
                successEvent: GenerateQRcode,
                getParams: { Id: Id, AddFlag: 1 },
                formValidator: function () {
                    var $form = $(".modal-form");
                    if (!$form.valid()) {
                        return false;
                    } else {
                        return true;
                    }
                },
                postComplete: function () {
                    reload();
                    $(".bootbox").modal("hide");
                    return true;
                },
            });
        }

        function GenerateQRcode() {


            var id = $("#typeId").val();
            var Amount = $("#dataAmount").val();
            var sign = $("#sign").val();
            var memberId = $("#roleId").val();
            if (id != "" && Amount != "") {
                var dialog = new $.whiskey.web.ajaxDialog({
                    caption: "扫码付款",
                    actionUrl: "/Members/MemberDeposit/GenerateQRcode",
                    lockButton: $(this),
                    dialog: "QRcodeDialog",
                    getParams: { Id: id, Amount: Amount, sign: sign, memberId: memberId },
                    formValidator: function () {
                        var $form = $(".modal-form");
                        if (!$form.valid()) {
                            return false;
                        } else {
                            return true;
                        }
                    },
                    postComplete: function () {

                    },
                });
            } else {
                $.whiskey.web.alert({
                    type: "info",
                    content: "请选择充值"
                });
                return false;
            }
        }
    </script>
}